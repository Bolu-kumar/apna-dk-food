<!-- apiKey: "AIzaSyBLvhQ5Ag0kDvqCVN1ggKmx1ZgBPk_XfYI",
authDomain: "diwakar-tiffin-services.firebaseapp.com", -->



<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Export Firebase Data to CSV</title>
    <script src="https://www.gstatic.com/firebasejs/7.14.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/7.14.0/firebase-database.js"></script>
</head>

<body>
    <button id="exportButton">Export Data to CSV</button>

    <!-- Template Stylesheet -->
    <script>
        // Firebase configuration
        const firebaseConfig = {
            apiKey: "AIzaSyBLvhQ5Ag0kDvqCVN1ggKmx1ZgBPk_XfYI",
            authDomain: "diwakar-tiffin-services.firebaseapp.com",
            databaseURL: "https://diwakar-tiffin-services-default-rtdb.firebaseio.com",
            projectId: "diwakar-tiffin-services",
            storageBucket: "diwakar-tiffin-services.appspot.com",
            messagingSenderId: "901872908984",
            appId: "1:901872908984:web:5eb4319972dbb49b4e524d"
        };

        // Initialize Firebase
        firebase.initializeApp(firebaseConfig);

        // Function to export data to CSV
        function exportToCsv(filename, rows) {
            var processRow = function (row) {
                var finalVal = '';
                for (var j = 0; j < row.length; j++) {
                    var innerValue = '';
                    if (row[j] !== undefined && row[j] !== null) {
                        innerValue = row[j].toString();
                    }
                    var result = innerValue.replace(/"/g, '""');
                    if (result.search(/("|,|\n)/g) >= 0)
                        result = '"' + result + '"';
                    if (j > 0)
                        finalVal += ',';
                    finalVal += result;
                }
                return finalVal + '\n';
            };

            var csvFile = '';
            for (var i = 0; i < rows.length; i++) {
                csvFile += processRow(rows[i]);
            }

            var blob = new Blob([csvFile], { type: 'text/csv;charset=utf-8;' });
            if (navigator.msSaveBlob) { // IE 10+
                navigator.msSaveBlob(blob, filename);
            } else {
                var link = document.createElement("a");
                if (link.download !== undefined) {
                    var url = URL.createObjectURL(blob);
                    link.setAttribute("href", url);
                    link.setAttribute("download", filename);
                    link.style.visibility = 'hidden';
                    document.body.appendChild(link);
                    link.click();
                    document.body.removeChild(link);
                }
            }
        }


        // Fetch data from Firebase and convert to CSV
        document.getElementById("exportButton").addEventListener("click", function () {
            firebase.database().ref('foodOrder').once('value', function (snapshot) {
                var data = snapshot.val();
                console.log(typeof (data))
                var rows = [];

                // Convert Firebase data to CSV format
                for (var key in data) {
                    if (data.hasOwnProperty(key)) {
                        var row = [];
                        // Push each field into the row array
                        row.push(data[key].orderId || ''); // Handle undefined or null values
                        row.push(data[key].name || ''); // Handle undefined or null values
                        row.push(data[key].address || ''); // Handle undefined or null values
                        row.push(data[key].phoneNumber || ''); // Handle undefined or null values
                        row.push(data[key].email || ''); // Handle undefined or null values
                        row.push(data[key].selectedMeal || ''); // Handle undefined or null values
                        row.push(data[key].totalAmount || ''); // Handle undefined or null values
                        row.push(data[key].status || ''); // Handle undefined or null values
                        row.push(data[key].deliveryMethod || ''); // Handle undefined or null values
                        row.push(data[key].timestamp || ''); // Handle undefined or null values
                        // Convert mealFields array to a string
                        var mealFields = data[key].mealFields ? data[key].mealFields.join(', ') : '';
                        row.push(mealFields);
                        // Add more fields if needed
                        rows.push(row);
                    }
                }

                // Export data to CSV
                exportToCsv('firebase_data.csv', rows);
            });
        });

    </script>
</body>

</html>